# Простая инструкция: Добавление юзеров и тегов в чаты

Эта инструкция для тех, кто не занимается программированием.

---

## Что делает этот скрипт?
- Позволяет быстро пригласить сразу много сотрудников и тегов в групповые чаты в Пачке, чтобы не добавлять их вручную по одному.

---

## Обязательные требования

- Ruby 2.7 или выше (если не установлен, инструкция ниже)
- Необходимые гемы: `httparty`, `dotenv`, `csv`, `terminal-table`

---
## Как установить Ruby 
Если на компьютере еще не установлен язык программирования Ruby:
   - Для Mac чаще всего Ruby уже есть (но иногда его нужно обновить)
   - Для Windows Ruby нужно установить отдельно
   - Инструкция по установке Ruby на официальном сайте: https://www.ruby-lang.org/ru/documentation/installation/
   - Для Windows: https://rubyinstaller.org/

## Как установить гемы
   - После установки Ruby, откройте командную строку
   - Установите необходимые гемы командами:
    ```
      gem install httparty dotenv csv bundler
    ```
   - Проверьте установку гемов командой: `gem list`

### Настройка API-токена

Для работы с API Пачки необходим действующий access_token с правами администратора:
1. Войдите в Пачку под своей учёткой администратора.
2. Перейдите в автоматизации → API → скопируйте access_token администратора.

### Что делать дальше:
1. Скачайте репозиторий
2. Перейдите в папку со скриптом
3. Создайте файл `.env` (можно скопировать и переименовать файл `.env example`)
4. Откройте файл `.env` в любом текстовом редакторе (Блокнот, VS Code, Sublime Text, Notepad++ и т.д.) 
5. Укажите ваш access_token в файле `.env`:
   ```
   PACHCA_API_TOKEN=ваш_токен_здесь
   ```
6. Не забудьте сохранить изменения.

## Как запустить программу
1. Откройте папку  со скриптом в Терминале
2. Установите зависимости:
   ```
   bundle install
   ```

Для удобства работы с программой мы создали интерактивное меню, которое позволяет выполнять все действия, просто нажимая цифры на клавиатуре.

3. Запустите интерактивное Меню:
   ```
   ruby pachca_menu.rb
   ```

4. При выборе действий 1, 2, 3 в Меню, в папке со скриптом автоматически будут создаваться `.csv` с выгрузками.

5. Для добавления юзеров в чаты из файла (пункт 6 в меню), используйте файл `users_to_chats.csv` в качестве шаблона — удалите примеры и замените на свои данные. Верхнюю строку с заголовками не удаляйте.

Структура:
- `user_id` - ID пользователя в Пачке 
- `user_name` - Имя пользователя 
- `chat_ids` - ID чатов, в которые нужно добавить пользователя, разделенные точкой с запятой (`;`)

- Затем сохраните изменения и запустите пункт 6 в Меню.

5. Для добавления тегов в чаты из файла (пункт 7 в Меню), используйте файл `tags_to_chats.csv` в качестве шаблона — удалите примеры и замените на свои данные. Верхнюю строку с заголовками не удаляйте. 

Структура:
- `tag_id` - ID тега в Пачке
- `tag_name` - Название тега
- `chat_ids` - ID чатов, в которые нужно добавить тег, разделенные точкой с запятой (`;`)

- Затем сохраните изменения и запустите пункт 7 в Меню.

**Примечание по работе с CSV-файлами**
Рекомендуем открывать CSV-файлы в Google Таблицах, чтобы информация отображалась корректно.
   Если открыли в Excel, а имена отображаются как непонятные символы:
   - Откройте Excel.
   - Выберите: Данные → Получить данные → Из текста/CSV (или Data → Get Data → From Text/CSV).
   - Найдите свой файл.
   - В появившемся окне выберите кодировку **65001: Unicode (UTF-8)**.
   - Нажмите "Загрузить".

## Безопасность

- Файл `.env` с токеном — это как ключ от вашей учетной записи. Не отправляйте его никому и не выкладывайте в интернет.
- Все токены передаются только в заголовках, не в URL
- Передача токена и данных осуществляется по HTTPS
- После добавления юзеров и тегов обязательно удалите токен из файла `.env`.

**Всё!**